{%- if show_rating and card_product.metafields.reviews.rating.value != blank -%}
  {% liquid
    assign rating_decimal = 0
    assign decimal = card_product.metafields.reviews.rating.value.rating | modulo: 1
    assign rating_value = card_product.metafields.reviews.rating.value.rating | round: 1
    assign rating_count = card_product.metafields.reviews.rating_count.value
    assign rating_max = card_product.metafields.reviews.rating.value.scale_max

    if decimal >= 0.3 and decimal <= 0.7
      assign rating_decimal = 0.5
    elsif decimal > 0.7
      assign rating_decimal = 1
    endif
  %}
  <div class="card__rating">
  <div
    class="rating"
    role="img"
    aria-label="{{ 'accessibility.star_reviews_info' | t: rating_value: rating_value, rating_max: rating_max }}"
  >
    <span
      aria-hidden="true"
      class="rating-star  {% if card_rating_type != 'count' %} rating-star--average {% endif %}"
      style="--rating: {{ rating_value | floor }}; --rating-max: {{ rating_max }}; --rating-decimal: {{ rating_decimal }};"
    ></span>
  </div>
  {% comment %}
  <p class="rating-text caption">
    <span aria-hidden="true">
      {{- card_product.metafields.reviews.rating.value }} /
      {{ card_product.metafields.reviews.rating.value.scale_max -}}
    </span>
  </p>
  {% endcomment %}
  {% if card_rating_type == 'count' %}
  <p class="rating-count caption">
    <span aria-hidden="true">({{ rating_count }})</span>
    <span class="visually-hidden">
      {{- rating_count }}
      {{ 'accessibility.total_reviews' | t -}}
    </span>
  </p>
  {% else %}
  <p class="rating-average inline-block caption">
    <span aria-hidden="true">
      {{- rating_value }} 
    </span>
  </p>
  {% endif %}
  </div>
{%- endif -%}