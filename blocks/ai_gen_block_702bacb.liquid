
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

<style>
  {% comment %} DESKTOP TIMELINE SETTINGS  {% endcomment %}
  .timeline-container-{{ ai_gen_id }} {
    padding: {{ block.settings.section_padding_top }}px 20px {{ block.settings.section_padding_bottom }}px;
    background-color: {{ block.settings.background_color }};
  }

  .timeline-wrapper-{{ ai_gen_id }} {
    max-width: {{ block.settings.max_width }}px;
    margin: 0 auto;
  }

  .timeline-header-{{ ai_gen_id }} {
    text-align: center;
    margin-bottom: 60px;
  }

  .timeline-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.title_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0 0 16px;
  }

  .timeline-description-{{ ai_gen_id }} {
    font-size: {{ block.settings.description_size }}px;
    color: {{ block.settings.description_color }};
    margin: 0;
  }

  .timeline-track-{{ ai_gen_id }} {
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 40px;
  }

  .timeline-line-{{ ai_gen_id }} {
    position: absolute;
    top: 50%;
    left: 40px;
    right: 40px;
    height: {{ block.settings.line_thickness }}px;
    background-color: {{ block.settings.line_color }};
    transform: translateY(-50%);
    z-index: 1;
  }

  .timeline-item-{{ ai_gen_id }} {
    position: relative;
    z-index: 2;
    display: flex;
    flex-direction: column;
    align-items: center;
    flex: 1;
  }

  .timeline-icon-wrapper-{{ ai_gen_id }} {
    width: {{ block.settings.icon_size }}px;
    height: {{ block.settings.icon_size }}px;
    border-radius: 50%;
    background-color: {{ block.settings.icon_background }};
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .timeline-icon-wrapper-{{ ai_gen_id }}:hover {
    transform: scale(1.1);
  }

  .timeline-icon-{{ ai_gen_id }} {
    width: calc({{ block.settings.icon_size }}px * 0.5);
    height: calc({{ block.settings.icon_size }}px * 0.5);
    color: {{ block.settings.icon_color }};
  }

  .timeline-icon-wrapper-{{ ai_gen_id }}:hover .timeline-icon-{{ ai_gen_id }} {
    color: {{ block.settings.icon_hover_color }};
  }

  .timeline-label-{{ ai_gen_id }} {
    margin-top: 16px;
    font-size: {{ block.settings.label_size }}px;
    font-family: "ABCWhyte-Book";
    color: {{ block.settings.label_color }};
    text-align: center;
    font-weight: 300;
  }

  {% comment %} MODAL SETTINGS {% endcomment %}

  .timeline-modal-overlay-{{ ai_gen_id }} {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: {{ block.settings.overlay_color }};
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
    z-index: 9998;
  }

  .timeline-modal-overlay-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
  }

  .timeline-modal-{{ ai_gen_id }} {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.9);
    background-color: {{ block.settings.modal_background }};
    border-radius: {{ block.settings.modal_border_radius }}px;
    max-width: {{ block.settings.modal_max_width }}px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    padding: 40px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 9999;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
  }

  .timeline-modal-{{ ai_gen_id }}.active {
    opacity: 1;
    visibility: visible;
    transform: translate(-50%, -50%) scale(1);
  }

  .timeline-modal-close-{{ ai_gen_id }} {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    cursor: pointer;
    padding: 8px;
    color: {{ block.settings.modal_text_color }};
    opacity: 0.7;
    transition: opacity 0.3s ease;
  }

  .timeline-modal-close-{{ ai_gen_id }}:hover {
    opacity: 1;
  }

  .timeline-modal-content-{{ ai_gen_id }} {
    padding-right: 20px;
  }

  .timeline-modal-title-{{ ai_gen_id }} {
    font-size: {{ block.settings.modal_title_size }}px;
    color: {{ block.settings.modal_title_color }};
    margin: 0 0 20px;
  }

  .timeline-modal-text-{{ ai_gen_id }} {
    font-size: {{ block.settings.modal_text_size }}px;
    color: {{ block.settings.modal_text_color }};
    line-height: 1.6;
  }

  .timeline-modal-image-{{ ai_gen_id }} {
    width: 100%;
    height: auto;
    border-radius: 8px;
    margin-bottom: 20px;
  }
{% comment %} MOBILE SETTINGS {% endcomment %}
  @media screen and (max-width: 768px) {
    .timeline-container-{{ ai_gen_id }} {
      padding: {{ block.settings.section_padding_top }}px 20px {{ block.settings.section_padding_bottom }}px;
    }
    .timeline-wrapper-{{ ai_gen_id }} {
      max-width: {{ block.settings.max_width }}px;
      margin-left: 10px;
    }

    .timeline-header-{{ ai_gen_id }} {
      text-align: left;
      margin-bottom: 10px;
      padding-left: 10px;   
    }
    .timeline-track-{{ ai_gen_id }} {
      flex-direction: column;
      align-items: flex-start;
      padding-left: 10px;
      padding-right: 40px;
    }

    .timeline-line-{{ ai_gen_id }} {
      top: 0;
      left: calc({{ block.settings.icon_size }}px / 2 + 40px);
      bottom: 0;
      right: auto;
      width: {{ block.settings.line_thickness }}px;
      height: auto;
      transform: translateX(-50%);
    }

    .timeline-item-{{ ai_gen_id }} {
      flex-direction: row;
      align-items: center;
      width: 100%;
      margin-bottom: 40px;
    }

    .timeline-item-{{ ai_gen_id }}:last-child {
      margin-bottom: 0;
    }

    .timeline-label-{{ ai_gen_id }} {
      margin-top: 0;
      margin-left: 20px;
      text-align: left;
    }

    .timeline-modal-{{ ai_gen_id }} {
      padding: 30px 20px;
      width: 95%;
      max-height: 90vh;
    }

    .timeline-modal-content-{{ ai_gen_id }} {
      padding-right: 0;
    }
  }
</style> 

<timeline-component-{{ ai_gen_id }} class="timeline-container-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="timeline-wrapper-{{ ai_gen_id }}">
    {% if block.settings.title != blank or block.settings.description != blank %}
      <div class="timeline-header-{{ ai_gen_id }}">
        {% if block.settings.title != blank %}
          <h2 class="timeline-title-{{ ai_gen_id }}">{{ block.settings.title }}</h2>
        {% endif %}
        {% if block.settings.description != blank %}
          <div class="timeline-description-{{ ai_gen_id }}">{{ block.settings.description }}</div>
        {% endif %}
      </div>
    {% endif %}

    <div class="timeline-track-{{ ai_gen_id }}">
      <div class="timeline-line-{{ ai_gen_id }}"></div>

      {% for i in (1..5) %}
        {% liquid
          assign enabled_key = 'item_' | append: i | append: '_enabled'
          assign label_key = 'item_' | append: i | append: '_label'
          assign icon_key = 'item_' | append: i | append: '_icon'
          assign modal_title_key = 'item_' | append: i | append: '_modal_title'
          assign modal_text_key = 'item_' | append: i | append: '_modal_text'
          assign modal_image_key = 'item_' | append: i | append: '_modal_image'

          assign enabled = block.settings[enabled_key]
          assign label = block.settings[label_key]
          assign icon = block.settings[icon_key]
          assign modal_title = block.settings[modal_title_key]
          assign modal_text = block.settings[modal_text_key]
          assign modal_image = block.settings[modal_image_key]
        %}

        {% if enabled %}
          <div class="timeline-item-{{ ai_gen_id }}" data-timeline-item="{{ i }}">
            <button
              class="timeline-icon-wrapper-{{ ai_gen_id }}"
              aria-label="Open {{ label }}"
              data-modal-trigger="{{ i }}"
            > 
              {% comment %} ICON RENDERING HERE {% endcomment %}
              {% if icon == 'gem-hand' %}
                {% render 'icon-gem-hand' %}
              {% elsif icon == 'dove' %}
                {% render 'icon-dove' %}
              {% elsif icon == 'magic-eye' %}
                {% render 'icon-magic-eye' %}
              {% elsif icon == 'revival' %}
                {% render 'icon-revival' %}
              {% elsif icon == 'head' %}
                {% render 'icon-head' %}
              {% endif %}
            </button>
            {% if label != blank %}
              <div class="timeline-label-{{ ai_gen_id }}">{{ label }}</div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>
  </div>

  <div class="timeline-modal-overlay-{{ ai_gen_id }}" data-modal-overlay></div>

  {% for i in (1..5) %}
    {% liquid
      assign enabled_key = 'item_' | append: i | append: '_enabled'
      assign modal_title_key = 'item_' | append: i | append: '_modal_title'
      assign modal_text_key = 'item_' | append: i | append: '_modal_text'
      assign modal_image_key = 'item_' | append: i | append: '_modal_image'

      assign enabled = block.settings[enabled_key]
      assign modal_title = block.settings[modal_title_key]
      assign modal_text = block.settings[modal_text_key]
      assign modal_image = block.settings[modal_image_key]
    %}

    {% if enabled %}
      <div class="timeline-modal-{{ ai_gen_id }}" data-modal="{{ i }}">
        <button
          class="timeline-modal-close-{{ ai_gen_id }}"
          aria-label="Close modal"
          data-modal-close
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <div class="timeline-modal-content-{{ ai_gen_id }}">
          {% if modal_image %}
            <img
              src="{{ modal_image | image_url: width: 800 }}"
              alt="{{ modal_title | escape }}"
              class="timeline-modal-image-{{ ai_gen_id }}"
              loading="lazy"
              width="800"
              height="auto"
            >
          {% endif %}
          {% if modal_title != blank %}
            <h3 class="timeline-modal-title-{{ ai_gen_id }}">{{ modal_title }}</h3>
          {% endif %}
          {% if modal_text != blank %}
            <div class="timeline-modal-text-{{ ai_gen_id }}">{{ modal_text }}</div>
          {% endif %}
        </div>
      </div>
    {% endif %}
  {% endfor %}
</timeline-component-{{ ai_gen_id }}>

<script>
  (function() {
    class TimelineComponent{{ ai_gen_id }} extends HTMLElement {
      constructor() {
        super();
        this.overlay = this.querySelector('[data-modal-overlay]');
        this.modals = this.querySelectorAll('[data-modal]');
        this.triggers = this.querySelectorAll('[data-modal-trigger]');
        this.closeButtons = this.querySelectorAll('[data-modal-close]');
      }

      connectedCallback() {
        this.setupEventListeners();
      }

      setupEventListeners() {
        this.triggers.forEach((trigger) => {
          trigger.addEventListener('click', () => {
            const modalId = trigger.getAttribute('data-modal-trigger');
            this.openModal(modalId);
          });
        });

        this.closeButtons.forEach((button) => {
          button.addEventListener('click', () => {
            this.closeAllModals();
          });
        });

        this.overlay.addEventListener('click', () => {
          this.closeAllModals();
        });

        document.addEventListener('keydown', (e) => {
          if (e.key === 'Escape') {
            this.closeAllModals();
          }
        });
      }

      openModal(modalId) {
        const modal = this.querySelector(`[data-modal="${modalId}"]`);
        if (modal) {
          this.overlay.classList.add('active');
          modal.classList.add('active');
          document.body.style.overflow = 'hidden';
        }
      }

      closeAllModals() {
        this.overlay.classList.remove('active');
        this.modals.forEach((modal) => {
          modal.classList.remove('active');
        });
        document.body.style.overflow = '';
      }
    }

    customElements.define('timeline-component-{{ ai_gen_id }}', TimelineComponent{{ ai_gen_id }});
  })();
</script>

{% schema %}
{
  "name": "Timeline",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section"
    },
    {
      "type": "richtext",
      "id": "title",
      "label": "Title",
      "default": "<p>Our Journey</p>"
    },
    {
      "type": "richtext",
      "id": "description",
      "label": "Description",
      "default": "<p>Click on each milestone to learn more about our story</p>"
    },
    {
      "type": "range",
      "id": "section_padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding top",
      "default": 60
    },
    {
      "type": "range",
      "id": "section_padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Padding bottom",
      "default": 60
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 800,
      "max": 1600,
      "step": 100,
      "unit": "px",
      "label": "Maximum width",
      "default": 1200
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Title style"
    },
    {
      "type": "range",
      "id": "title_size",
      "min": 20,
      "max": 60,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 36
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#4f0e0d"
    },
    {
      "type": "range",
      "id": "description_size",
      "min": 12,
      "max": 24,
      "step": 1,
      "unit": "px",
      "label": "Description size",
      "default": 16
    },
    {
      "type": "color",
      "id": "description_color",
      "label": "Description color",
      "default": "#4f0e0d"
    },
    {
      "type": "header",
      "content": "Timeline line"
    },
    {
      "type": "range",
      "id": "line_thickness",
      "min": 1,
      "max": 6,
      "step": 1,
      "unit": "px",
      "label": "Line thickness",
      "default": 2
    },
    {
      "type": "color",
      "id": "line_color",
      "label": "Line color",
      "default": "#ece6da"
    },
    {
      "type": "header",
      "content": "Timeline icons"
    },
    {
      "type": "range",
      "id": "icon_size",
      "min": 40,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Icon size",
      "default": 60
    },
    {
      "type": "color",
      "id": "icon_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon color",
      "default": "#4f0e0d"
    },
    {
      "type": "color",
      "id": "icon_border_color",
      "label": "Border color",
      "default": "#ece6da"
    },
    {
      "type": "range",
      "id": "icon_border_width",
      "min": 1,
      "max": 4,
      "step": 1,
      "unit": "px",
      "label": "Border width",
      "default": 2
    },
    {
      "type": "color",
      "id": "icon_hover_background",
      "label": "Hover background",
      "default": "#4f0e0d"
    },
    {
      "type": "color",
      "id": "icon_hover_color",
      "label": "Hover icon color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "icon_hover_border_color",
      "label": "Hover border color",
      "default": "#4f0e0d"
    },
    {
      "type": "range",
      "id": "label_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Label size",
      "default": 14
    },
    {
      "type": "color",
      "id": "label_color",
      "label": "Label color",
      "default": "#4f0e0d"
    },
    {
      "type": "header",
      "content": "Modal style"
    },
    {
      "type": "range",
      "id": "modal_max_width",
      "min": 400,
      "max": 900,
      "step": 50,
      "unit": "px",
      "label": "Maximum width",
      "default": 700
    },
    {
      "type": "range",
      "id": "modal_border_radius",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Border radius",
      "default": 8
    },
    {
      "type": "color",
      "id": "modal_background",
      "label": "Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "Overlay color",
      "default": "rgba(0, 0, 0, 0.6)"
    },
    {
      "type": "range",
      "id": "modal_title_size",
      "min": 20,
      "max": 40,
      "step": 2,
      "unit": "px",
      "label": "Title size",
      "default": 28
    },
    {
      "type": "color",
      "id": "modal_title_color",
      "label": "Title color",
      "default": "#4f0e0d"
    },
    {
      "type": "range",
      "id": "modal_text_size",
      "min": 12,
      "max": 20,
      "step": 1,
      "unit": "px",
      "label": "Text size",
      "default": 16
    },
    {
      "type": "color",
      "id": "modal_text_color",
      "label": "Text color",
      "default": "#4f0e0d"
    },
    {
      "type": "header",
      "content": "Item 1"
    },
    {
      "type": "checkbox",
      "id": "item_1_enabled",
      "label": "Enable item 1",
      "default": true
    },
    {
      "type": "text",
      "id": "item_1_label",
      "label": "Label",
      "default": "2020"
    },
    {
      "type": "select",
      "id": "item_1_icon",
      "label": "Icon",
      "options": [
        { "value": "gem-hand", "label": "Gem Hand" },
        { "value": "dove", "label": "Dove" },
        { "value": "magic-eye", "label": "Magic Eye" },
        { "value": "revival", "label": "Gem Revival" },
        { "value": "head", "label": "Head" }
      ],
      "default": "gem-hand"
    },
    {
      "type": "text",
      "id": "item_1_modal_title",
      "label": "Modal title",
      "default": "The Beginning"
    },
    {
      "type": "richtext",
      "id": "item_1_modal_text",
      "label": "Modal text",
      "default": "<p>This is where our journey started. We had a vision to create something special.</p>"
    },
    {
      "type": "image_picker",
      "id": "item_1_modal_image",
      "label": "Modal image"
    },
    {
      "type": "header",
      "content": "Item 2"
    },
    {
      "type": "checkbox",
      "id": "item_2_enabled",
      "label": "Enable item 2",
      "default": true
    },
    {
      "type": "text",
      "id": "item_2_label",
      "label": "Label",
      "default": "2021"
    },
    {
      "type": "select",
      "id": "item_2_icon",
      "label": "Icon",
      "options": [
        { "value": "gem-hand", "label": "Gem Hand" },
        { "value": "dove", "label": "Dove" },
        { "value": "magic-eye", "label": "Magic Eye" },
        { "value": "revival", "label": "Gem Revival" },
        { "value": "head", "label": "Head" }
      ],
      "default": "dove"
    },
    {
      "type": "text",
      "id": "item_2_modal_title",
      "label": "Modal title",
      "default": "First Milestone"
    },
    {
      "type": "richtext",
      "id": "item_2_modal_text",
      "label": "Modal text",
      "default": "<p>We reached our first major milestone and expanded our team.</p>"
    },
    {
      "type": "image_picker",
      "id": "item_2_modal_image",
      "label": "Modal image"
    },
    {
      "type": "header",
      "content": "Item 3"
    },
    {
      "type": "checkbox",
      "id": "item_3_enabled",
      "label": "Enable item 3",
      "default": true
    },
    {
      "type": "text",
      "id": "item_3_label",
      "label": "Label",
      "default": "2022"
    },
    {
      "type": "select",
      "id": "item_3_icon",
      "label": "Icon",
      "options": [
        { "value": "gem-hand", "label": "Gem Hand" },
        { "value": "dove", "label": "Dove" },
        { "value": "magic-eye", "label": "Magic Eye" },
        { "value": "revival", "label": "Gem Revival" },
        { "value": "head", "label": "Head" }
      ],
      "default": "magic-eye"
    },
    {
      "type": "text",
      "id": "item_3_modal_title",
      "label": "Modal title",
      "default": "Growth Phase"
    },
    {
      "type": "richtext",
      "id": "item_3_modal_text",
      "label": "Modal text",
      "default": "<p>Our business grew exponentially and we opened new locations.</p>"
    },
    {
      "type": "image_picker",
      "id": "item_3_modal_image",
      "label": "Modal image"
    },
    {
      "type": "header",
      "content": "Item 4"
    },
    {
      "type": "checkbox",
      "id": "item_4_enabled",
      "label": "Enable item 4",
      "default": true
    },
    {
      "type": "text",
      "id": "item_4_label",
      "label": "Label",
      "default": "2023"
    },
    {
      "type": "select",
      "id": "item_4_icon",
      "label": "Icon",
      "options": [
        { "value": "gem-hand", "label": "Gem Hand" },
        { "value": "dove", "label": "Dove" },
        { "value": "magic-eye", "label": "Magic Eye" },
        { "value": "revival", "label": "Gem Revival" },
        { "value": "head", "label": "Head" }
      ],
      "default": "revival"
    },
    {
      "type": "text",
      "id": "item_4_modal_title",
      "label": "Modal title",
      "default": "Award Winning"
    },
    {
      "type": "richtext",
      "id": "item_4_modal_text",
      "label": "Modal text",
      "default": "<p>We received industry recognition and multiple awards for our work.</p>"
    },
    {
      "type": "image_picker",
      "id": "item_4_modal_image",
      "label": "Modal image"
    },
    {
      "type": "header",
      "content": "Item 5"
    },
    {
      "type": "checkbox",
      "id": "item_5_enabled",
      "label": "Enable item 5",
      "default": true
    },
    {
      "type": "text",
      "id": "item_5_label",
      "label": "Label",
      "default": "2024"
    },
    {
      "type": "select",
      "id": "item_5_icon",
      "label": "Icon",
      "options": [
        { "value": "gem-hand", "label": "Gem Hand" },
        { "value": "dove", "label": "Dove" },
        { "value": "magic-eye", "label": "Magic Eye" },
        { "value": "revival", "label": "Gem Revival" },
        { "value": "head", "label": "Head" }
      ],
      "default": "head"
    },
    {
      "type": "text",
      "id": "item_5_modal_title",
      "label": "Modal title",
      "default": "The Future"
    },
    {
      "type": "richtext",
      "id": "item_5_modal_text",
      "label": "Modal text",
      "default": "<p>Looking ahead to new innovations and continued success.</p>"
    },
    {
      "type": "image_picker",
      "id": "item_5_modal_image",
      "label": "Modal image"
    }
  ],
  "presets": [
    {
      "name": "Timeline"
    }
  ]
}
{% endschema %}